<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connect — Jasroop</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
  <link rel="stylesheet" href="assets/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Italianno&display=swap" rel="stylesheet">
  <style>
    /* ── Centered stacked layout ────────────────────── */
    .connect-header {
      text-align: center;
      padding: var(--sp7) 0 var(--sp5);
    }
    .connect-header h1 {
      margin-bottom: var(--sp2);
    }
    .connect-header .status-pill {
      font-size: 0.9rem;
      padding: 8px 20px;
      gap: 10px;
    }
    .connect-header .connect-info {
      font-size: 0.95rem;
      font-weight: 300;
      color: var(--muted);
      line-height: 1.8;
      margin-top: var(--sp3);
    }
    .connect-header .connect-info a {
      font-size: 0.95rem;
      font-weight: 400;
      color: var(--text);
    }

    .connect-right-label {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 3rem;
      color: rgba(24,24,24,0.35);
      margin-bottom: 14px;
      text-align: center;
    }

    /* ── The Letter ──────────────────────────────────── */
    .letter {
      width: 100%;
      max-width: 900px;
      background: #fffdf8;
      border: 1px solid rgba(24,24,24,0.06);
      position: relative;
      box-shadow:
        0 1px 3px rgba(0,0,0,0.04),
        4px 4px 0 #f5f2ec,
        5px 5px 0 rgba(24,24,24,0.04),
        8px 8px 0 #f0ede7,
        9px 9px 0 rgba(24,24,24,0.03);
      overflow: visible;
      min-height: 520px;
    }
    .letter::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: repeating-linear-gradient(
        transparent,
        transparent 31px,
        rgba(160,190,220,0.16) 31px,
        rgba(160,190,220,0.16) 32px
      );
      pointer-events: none;
      z-index: 0;
    }
    .letter::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 64px;
      width: 1px;
      background: rgba(210,100,100,0.22);
      pointer-events: none;
      z-index: 1;
    }

    .letter-content {
      position: relative;
      z-index: 2;
      padding: 0 32px 0 82px;
      padding-top: 7px;
    }

    .letter-date {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.5rem;
      color: #3a1520;
      text-align: right;
      margin: 0;
      line-height: 32px;
      height: 32px;
    }

    .letter-greeting {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 2.2rem;
      color: #2e1018;
      margin: 0;
      line-height: 32px;
      height: 32px;
    }

    .letter-form {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .letter-form textarea {
      background: transparent;
      border: none;
      color: #2e1018;
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      padding: 0;
      outline: none;
      resize: none;
      min-height: 192px;
      text-indent: 2.5em;
      line-height: 32px;
      width: 100%;
    }
    .letter-form textarea::placeholder {
      color: rgba(46,16,24,0.2);
      font-family: 'Italianno', cursive;
    }

    /* ── Sign-off row ── */
    .sign-off-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      line-height: 32px;
      height: 32px;
    }
    .letter-sign-off {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      color: #3a1520;
      margin: 0;
    }
    .anon-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .anon-toggle input[type="checkbox"] {
      accent-color: #7a4a5a;
      width: 12px;
      height: 12px;
      cursor: pointer;
    }
    .anon-toggle span {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      color: #3a1520;
      white-space: nowrap;
      opacity: 0.45;
    }

    /* ── Sender fields — hidden when anon ── */
    .sign-off-block {
      transition: opacity 0.3s ease, max-height 0.3s ease;
      overflow: hidden;
      max-height: 300px;
    }
    .sign-off-block.hidden {
      opacity: 0;
      max-height: 0;
      pointer-events: none;
    }
    .sender-fields {
      display: grid;
      gap: 0;
    }
    .sender-row {
      display: flex;
      align-items: baseline;
      gap: 8px;
      height: 32px;
      line-height: 32px;
    }
    .sender-row label {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      color: #3a1520;
      opacity: 0.45;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .sender-row input {
      flex: 1;
      background: transparent;
      border: none;
      border-bottom: none;
      color: #2e1018;
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      padding: 0 2px;
      outline: none;
      line-height: 32px;
      height: 32px;
    }
    .sender-row input::placeholder {
      color: rgba(46,16,24,0.18);
      font-family: 'Italianno', cursive;
    }

    /* ── Send button ─────────────────────────────────── */
    .letter-send {
      height: 32px;
      line-height: 32px;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 32px;
    }
    .send-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #fffdf8;
      border: 1.5px solid rgba(24,24,24,0.1);
      padding: 8px 22px 8px 16px;
      cursor: pointer;
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 1.8rem;
      color: #2e1018;
      border-radius: 32px;
      transition: all 0.2s ease;
      outline: none;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .send-btn:hover {
      background: #f5f0e8;
      border-color: rgba(24,24,24,0.2);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
    }
    .send-btn svg {
      width: 20px;
      height: 20px;
      transition: transform 0.3s ease;
    }
    .send-btn:hover svg {
      transform: translate(3px, -3px) rotate(-5deg);
    }

    /* ── Doodle overlay — covers entire letter ──────── */
    .doodle-layer {
      position: absolute;
      inset: 0;
      z-index: 4;
      pointer-events: none;
    }
    .placed-doodle {
      position: absolute;
      width: 38px;
      height: 38px;
      pointer-events: auto;
      cursor: grab;
      user-select: none;
      animation: doodle-pop 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    .placed-doodle.dragging { cursor: grabbing; z-index: 10; }
    .placed-doodle:hover { filter: brightness(1.08); }
    @keyframes doodle-pop {
      0% { opacity: 0; transform: scale(0); }
      100% { opacity: 1; transform: scale(1); }
    }
    .placed-doodle svg { width: 100%; height: 100%; pointer-events: none; }
    .placed-doodle .doodle-x {
      position: absolute;
      top: -6px;
      right: -6px;
      width: 16px;
      height: 16px;
      background: rgba(24,24,24,0.08);
      border: none;
      border-radius: 50%;
      color: rgba(24,24,24,0.4);
      font-size: 10px;
      line-height: 16px;
      text-align: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.15s ease;
      pointer-events: auto;
      padding: 0;
    }
    .placed-doodle:hover .doodle-x { opacity: 1; }

    /* Doodle toolbar */
    .doodle-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
      margin-bottom: 12px;
      align-items: center;
    }
    .doodle-toolbar button,
    .doodle-toolbar label {
      background: transparent;
      border: 1px solid transparent;
      padding: 3px;
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }
    .doodle-toolbar button:hover,
    .doodle-toolbar label:hover {
      transform: scale(1.2) rotate(-8deg);
      background: rgba(24,24,24,0.03);
      border-color: rgba(24,24,24,0.06);
    }
    .doodle-toolbar button.active,
    .doodle-toolbar label.active {
      background: rgba(24,24,24,0.06);
      border-color: rgba(24,24,24,0.12);
      transform: scale(1.1);
    }
    .doodle-toolbar button svg,
    .doodle-toolbar label svg { width: 22px; height: 22px; }
    .doodle-toolbar .sep {
      width: 1px;
      height: 24px;
      background: rgba(24,24,24,0.08);
      margin: 0 6px;
      flex-shrink: 0;
    }

    /* Drawing canvas — always present, pointer-events toggled */
    .draw-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
      pointer-events: none;
    }
    .draw-canvas.active {
      pointer-events: auto;
      cursor: crosshair;
    }
    .draw-canvas.erasing {
      pointer-events: auto;
      cursor: cell;
    }

    /* Color picker strip */
    .color-strip {
      display: none;
      gap: 4px;
      align-items: center;
      margin-left: 4px;
    }
    .color-strip.visible { display: flex; }
    .color-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.12s ease;
    }
    .color-dot:hover { transform: scale(1.3); }
    .color-dot.active { border-color: rgba(24,24,24,0.3); }

    /* ── Sent state — folded letter ──────────────────── */
    .letter.sent {
      min-height: 0 !important;
      height: 220px;
      transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                  min-height 0.6s ease,
                  box-shadow 0.4s ease;
      box-shadow:
        0 1px 3px rgba(0,0,0,0.04),
        3px 3px 0 #f5f2ec,
        4px 4px 0 rgba(24,24,24,0.03);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .letter.sent::before,
    .letter.sent::after { display: none; }
    .letter.sent .letter-content {
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Fold creases */
    .fold-lines {
      display: none;
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 1;
    }
    .letter.sent .fold-lines { display: block; }
    .fold-lines::before {
      content: '';
      position: absolute;
      top: 33.3%;
      left: 12px;
      right: 12px;
      height: 1px;
      background: rgba(24,24,24,0.06);
    }
    .fold-lines::after {
      content: '';
      position: absolute;
      top: 66.6%;
      left: 12px;
      right: 12px;
      height: 1px;
      background: rgba(24,24,24,0.06);
    }

    .form-sent {
      display: none;
      text-align: center;
      padding: 20px 32px;
      position: relative;
      z-index: 2;
      width: 100%;
    }
    .form-sent h2 {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      font-size: 3rem;
      margin-bottom: 6px;
      color: #2e1018;
    }
    .form-sent p {
      font-family: 'Italianno', cursive;
      font-weight: 400;
      color: var(--muted);
      font-size: 2rem;
    }

    @media (max-width: 860px) {
      .letter { max-width: 100%; }
    }
    @media (max-width: 520px) {
      .letter-content { padding: 20px 20px 24px 74px; }
      .doodle-margin { width: 56px; }
      .letter::after { left: 56px; }
    }
  </style>
</head>
<body>
  <main class="page">

    <nav>
      <a href="index.html" class="logo">jasroop dhingra</a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="work.html">Work</a>
        <a href="books/books.html">Books</a>
        <a href="writings/writings.html">Writing</a>
        <a href="connect.html">Connect</a>
      </div>
    </nav>
    <section class="section reveal" style="display:flex; flex-direction:column; align-items:center;">
        <p class="connect-right-label" id="letterLabel">Write me a letter!</p>

        <!-- Doodle toolbar: stickers + draw + colors -->
        <div class="doodle-toolbar" id="doodleToolbar">
          <button type="button" data-sticker="sparkle" title="Sparkle">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gSparkle" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffe066"/><stop offset="100%" stop-color="#ff6fd8"/></linearGradient></defs><path d="M20 4l3 10 10 3-10 3-3 10-3-10-10-3 10-3z" fill="url(#gSparkle)"/><circle cx="12" cy="8" r="1.2" fill="#fff" opacity="0.9"/><circle cx="30" cy="28" r="1" fill="#fff" opacity="0.8"/><circle cx="28" cy="10" r="0.8" fill="#fff" opacity="0.7"/></svg>
          </button>
          <button type="button" data-sticker="star" title="Star">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gStar" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#a78bfa"/><stop offset="50%" stop-color="#f472b6"/><stop offset="100%" stop-color="#fbbf24"/></linearGradient></defs><path d="M20 4l4.5 10.5H36l-9 7 3.5 11L20 26l-10.5 6.5 3.5-11-9-7h11.5z" fill="url(#gStar)"/><circle cx="18" cy="16" r="2" fill="#fff" opacity="0.45"/></svg>
          </button>
          <button type="button" data-sticker="heart" title="Heart">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gHeart" x1="0" y1="0" x2="0.5" y2="1"><stop offset="0%" stop-color="#ff5edb"/><stop offset="100%" stop-color="#ff3860"/></linearGradient></defs><path d="M20 34s-12-8-12-16c0-5 4-8 8-7 2 .5 3 2 4 4 1-2 2-3.5 4-4 4-1 8 2 8 7 0 8-12 16-12 16z" fill="url(#gHeart)"/><ellipse cx="15" cy="16" rx="3" ry="2" fill="#fff" opacity="0.35" transform="rotate(-20 15 16)"/></svg>
          </button>
          <button type="button" data-sticker="flame" title="Flame">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gFlame" x1="0.5" y1="1" x2="0.5" y2="0"><stop offset="0%" stop-color="#ff3860"/><stop offset="50%" stop-color="#ff9f43"/><stop offset="100%" stop-color="#ffe066"/></linearGradient></defs><path d="M20 4c0 0-10 12-10 20 0 7 4.5 12 10 12s10-5 10-12C30 16 20 4 20 4z" fill="url(#gFlame)"/><ellipse cx="20" cy="28" rx="4" ry="6" fill="#fff" opacity="0.25"/></svg>
          </button>
          <button type="button" data-sticker="gem" title="Gem">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gGem" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#60efff"/><stop offset="50%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#f472b6"/></linearGradient></defs><polygon points="20,4 34,16 28,36 12,36 6,16" fill="url(#gGem)"/><polygon points="20,4 14,16 26,16" fill="#fff" opacity="0.3"/><line x1="14" y1="16" x2="12" y2="36" stroke="#fff" stroke-width="0.5" opacity="0.25"/><line x1="26" y1="16" x2="28" y2="36" stroke="#fff" stroke-width="0.5" opacity="0.25"/><line x1="14" y1="16" x2="28" y2="36" stroke="#fff" stroke-width="0.3" opacity="0.15"/></svg>
          </button>
          <button type="button" data-sticker="moon" title="Moon">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gMoon" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c4b5fd"/><stop offset="100%" stop-color="#818cf8"/></linearGradient></defs><path d="M26 6c-8 2-14 10-10 20s14 10 18 4c-4 2-10 0-12-8s0-12 4-16z" fill="url(#gMoon)"/><circle cx="18" cy="14" r="1" fill="#fff" opacity="0.7"/><circle cx="14" cy="22" r="0.7" fill="#fff" opacity="0.5"/><circle cx="22" cy="26" r="0.6" fill="#fff" opacity="0.4"/></svg>
          </button>
          <button type="button" data-sticker="lightning" title="Lightning">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gBolt" x1="0" y1="0" x2="0.8" y2="1"><stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f97316"/></linearGradient></defs><polygon points="22,2 10,22 18,22 16,38 30,16 22,16" fill="url(#gBolt)"/><polygon points="22,2 17,14 22,16" fill="#fff" opacity="0.35"/></svg>
          </button>
          <button type="button" data-sticker="butterfly" title="Butterfly">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gBflyL" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c084fc"/><stop offset="100%" stop-color="#22d3ee"/></linearGradient><linearGradient id="gBflyR" x1="1" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fb7185"/><stop offset="100%" stop-color="#a78bfa"/></linearGradient></defs><path d="M20 14c-4-7-14-9-14-2s8 10 14 10" fill="url(#gBflyL)"/><path d="M20 14c4-7 14-9 14-2s-8 10-14 10" fill="url(#gBflyR)"/><path d="M20 12v20" stroke="#7c3aed" stroke-width="1.5" stroke-linecap="round"/><circle cx="13" cy="12" r="1.5" fill="#fff" opacity="0.5"/><circle cx="27" cy="12" r="1.5" fill="#fff" opacity="0.5"/></svg>
          </button>
          <button type="button" data-sticker="cherry" title="Cherry">
            <svg viewBox="0 0 40 40"><defs><radialGradient id="gCherry"><stop offset="0%" stop-color="#ff8a9e"/><stop offset="100%" stop-color="#e11d48"/></radialGradient></defs><circle cx="14" cy="28" r="7" fill="url(#gCherry)"/><circle cx="28" cy="26" r="6" fill="url(#gCherry)"/><ellipse cx="12" cy="24" rx="2.5" ry="1.5" fill="#fff" opacity="0.35" transform="rotate(-30 12 24)"/><ellipse cx="26" cy="22" rx="2" ry="1.2" fill="#fff" opacity="0.3" transform="rotate(-30 26 22)"/><path d="M14 21c2-8 6-14 10-16" stroke="#16a34a" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M28 20c0-6 0-12-4-14" stroke="#16a34a" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M22 6c2 0 5 1 5 4" stroke="#22c55e" stroke-width="1.2" fill="none" stroke-linecap="round"/></svg>
          </button>
          <button type="button" data-sticker="alien" title="Alien">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gAlien" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0%" stop-color="#a3e635"/><stop offset="100%" stop-color="#22d3ee"/></linearGradient></defs><ellipse cx="20" cy="22" rx="12" ry="14" fill="url(#gAlien)"/><ellipse cx="14" cy="20" rx="4" ry="5" fill="#0f172a" rx="4" ry="5"/><ellipse cx="26" cy="20" rx="4" ry="5" fill="#0f172a"/><ellipse cx="15" cy="19" rx="1.5" ry="2" fill="#fff" opacity="0.5"/><ellipse cx="27" cy="19" rx="1.5" ry="2" fill="#fff" opacity="0.5"/><path d="M17 30c1.5 1.5 4 1.5 6 0" stroke="#064e3b" stroke-width="1" fill="none" stroke-linecap="round"/></svg>
          </button>
          <button type="button" data-sticker="planet" title="Planet">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gPlanet" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#818cf8"/><stop offset="50%" stop-color="#e879f9"/><stop offset="100%" stop-color="#fb923c"/></linearGradient></defs><circle cx="20" cy="20" r="10" fill="url(#gPlanet)"/><ellipse cx="20" cy="20" rx="18" ry="5" fill="none" stroke="url(#gPlanet)" stroke-width="1.8" transform="rotate(-25 20 20)" opacity="0.7"/><circle cx="16" cy="16" r="2" fill="#fff" opacity="0.3"/></svg>
          </button>
          <button type="button" data-sticker="rainbow" title="Rainbow">
            <svg viewBox="0 0 40 40"><defs><linearGradient id="gRbow" x1="0" y1="1" x2="1" y2="0"><stop offset="0%" stop-color="#ef4444"/><stop offset="20%" stop-color="#f97316"/><stop offset="40%" stop-color="#eab308"/><stop offset="60%" stop-color="#22c55e"/><stop offset="80%" stop-color="#3b82f6"/><stop offset="100%" stop-color="#a855f7"/></linearGradient></defs><path d="M4 32c0-12 7-22 16-22s16 10 16 22" stroke="url(#gRbow)" stroke-width="6" stroke-linecap="round" fill="none"/><path d="M4 32c0-12 7-22 16-22s16 10 16 22" stroke="#fff" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.25"/></svg>
          </button>
          <span class="sep"></span>
          <!-- Draw toggle -->
          <button type="button" id="drawToggle" title="Draw your own doodle">
            <svg viewBox="0 0 40 40" fill="none"><path d="M8 32l2-8 18-18 6 6-18 18-8 2z" stroke="#5a7a9a" stroke-width="1.5" fill="rgba(90,122,154,0.06)" stroke-linecap="round" stroke-linejoin="round"/><path d="M26 12l6 6" stroke="#5a7a9a" stroke-width="1.3" stroke-linecap="round"/></svg>
          </button>
          <!-- Eraser -->
          <button type="button" id="eraserToggle" title="Eraser">
            <svg viewBox="0 0 40 40" fill="none"><rect x="10" y="18" width="20" height="12" rx="2" stroke="#aaa" stroke-width="1.5" fill="rgba(180,180,180,0.1)" transform="rotate(-20 20 24)"/><path d="M14 34h12" stroke="#aaa" stroke-width="1.3" stroke-linecap="round"/></svg>
          </button>
          <!-- Color strip -->
          <div class="color-strip" id="colorStrip">
            <span class="color-dot active" data-color="#2a3a5a" style="background:#2a3a5a;" title="Ink"></span>
            <span class="color-dot" data-color="#e07878" style="background:#e07878;" title="Rose"></span>
            <span class="color-dot" data-color="#5a9a5a" style="background:#5a9a5a;" title="Green"></span>
            <span class="color-dot" data-color="#d4a840" style="background:#d4a840;" title="Gold"></span>
            <span class="color-dot" data-color="#7a9ab8" style="background:#7a9ab8;" title="Blue"></span>
            <span class="color-dot" data-color="#9a78c8" style="background:#9a78c8;" title="Purple"></span>
            <span class="color-dot" data-color="#cc6a4a" style="background:#cc6a4a;" title="Rust"></span>
          </div>
        </div>

        <!-- Letter -->
        <div class="letter" id="letterWrap">
          <div class="fold-lines"></div>
          <div class="doodle-layer" id="doodleLayer"></div>
          <canvas class="draw-canvas" id="drawCanvas"></canvas>
          <div class="letter-content">
            <form id="contactForm" class="letter-form"
                  action="https://formspree.io/f/xbdaznzg"
                  method="POST">

              <p class="letter-date" id="letterDate"></p>
              <p class="letter-greeting">Dear Jasroop,</p>

              <textarea name="message" rows="6" placeholder="I wanted to write to you about..." required></textarea>

              <div class="sign-off-row">
                <p class="letter-sign-off">With warmth,</p>
                <label class="anon-toggle">
                  <input type="checkbox" id="anonToggle" />
                  <span>Or send anonymously</span>
                </label>
              </div>

              <div class="sign-off-block" id="signOffBlock">
                <div class="sender-fields">
                  <div class="sender-row">
                    <input type="text" name="name" placeholder="Your name" />
                  </div>
                  <div class="sender-row">
                    <input type="email" name="_replyto" placeholder="Your email" />
                  </div>
                </div>
              </div>

              <input type="hidden" name="stickers" id="stickersField" value="" />

              <div class="letter-send">
                <button type="submit" class="send-btn">
                  <svg viewBox="0 0 40 40" fill="none">
                    <path d="M6 20L34 8l-6 26-10-10L34 8" stroke="#6a8aaa" stroke-width="1.5" fill="rgba(106,138,170,0.06)" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18 24v8l4-5" stroke="#6a8aaa" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                  </svg>
                  Send Letter
                </button>
              </div>
            </form>

            <div id="formSent" class="form-sent">
              <h2>Your letter is on its way!</h2>
              <p>Thanks for writing — I'll send one back soon.</p>
            </div>
          </div>
        </div>
    </section>

    <footer class="site-footer">
      <p>Jasroop Dhingra · 2026</p>
      <p>Boston, MA</p>
    </footer>

  </main>

  <script src="assets/main.js"></script>
  <script>
    const d = new Date();
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    document.getElementById('letterDate').textContent = months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();

    // Anonymous toggle
    const anonToggle = document.getElementById('anonToggle');
    const signOffBlock = document.getElementById('signOffBlock');
    anonToggle.addEventListener('change', () => {
      signOffBlock.classList.toggle('hidden', anonToggle.checked);
      signOffBlock.querySelectorAll('input').forEach(inp => {
        if (anonToggle.checked) { inp.removeAttribute('required'); inp.value = ''; }
      });
    });

    // ── Draggable doodle stickers ──────────────────────
    const letter = document.getElementById('letterWrap');
    const layer = document.getElementById('doodleLayer');
    const stickersField = document.getElementById('stickersField');

    function updateStickersField() {
      const names = [];
      layer.querySelectorAll('.placed-doodle').forEach(d => names.push(d.dataset.name));
      stickersField.value = names.join(', ');
    }

    function makeDraggable(el) {
      let startX, startY, origX, origY;

      function onDown(e) {
        if (e.target.classList.contains('doodle-x')) return;
        e.preventDefault();
        el.classList.add('dragging');
        const pt = e.touches ? e.touches[0] : e;
        const rect = letter.getBoundingClientRect();
        startX = pt.clientX;
        startY = pt.clientY;
        origX = el.offsetLeft;
        origY = el.offsetTop;
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend', onUp);
      }
      function onMove(e) {
        e.preventDefault();
        const pt = e.touches ? e.touches[0] : e;
        const dx = pt.clientX - startX;
        const dy = pt.clientY - startY;
        el.style.left = (origX + dx) + 'px';
        el.style.top = (origY + dy) + 'px';
      }
      function onUp() {
        el.classList.remove('dragging');
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', onUp);
      }
      el.addEventListener('mousedown', onDown);
      el.addEventListener('touchstart', onDown, { passive: false });
    }

    function placeDoodle(svgHTML, name, x, y) {
      const el = document.createElement('div');
      el.className = 'placed-doodle';
      el.dataset.name = name;
      const rot = Math.floor(Math.random() * 24) - 12;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      el.style.transform = 'rotate(' + rot + 'deg)';
      el.innerHTML = svgHTML + '<button class="doodle-x" title="Remove">×</button>';
      el.querySelector('.doodle-x').addEventListener('click', () => {
        el.style.transform = 'scale(0)';
        el.style.opacity = '0';
        setTimeout(() => { el.remove(); updateStickersField(); }, 200);
      });
      makeDraggable(el);
      layer.appendChild(el);
      updateStickersField();
    }

    // Sticker buttons — click to place at a random spot
    document.querySelectorAll('.doodle-toolbar button[data-sticker]').forEach(btn => {
      btn.addEventListener('click', () => {
        if (mode !== 'none') return;
        const lw = letter.offsetWidth;
        const lh = letter.offsetHeight;
        const x = 10 + Math.floor(Math.random() * (lw - 50));
        const y = 10 + Math.floor(Math.random() * (lh - 50));
        placeDoodle(btn.querySelector('svg').outerHTML, btn.dataset.sticker, x, y);
      });
    });

    // ── Freehand drawing ──────────────────────────────
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const drawBtn = document.getElementById('drawToggle');
    const eraserBtn = document.getElementById('eraserToggle');
    const colorStrip = document.getElementById('colorStrip');
    let mode = 'none'; // 'none' | 'draw' | 'erase'
    let drawing = false;
    let drawColor = '#2a3a5a';
    let canvasReady = false;

    function ensureCanvas() {
      if (canvasReady) return;
      const dpr = window.devicePixelRatio || 1;
      const w = letter.offsetWidth;
      const h = letter.offsetHeight;
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.scale(dpr, dpr);
      canvasReady = true;
    }

    function applyBrush() {
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      if (mode === 'erase') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = 20;
      } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = drawColor;
        ctx.lineWidth = 2.5;
      }
    }

    function setMode(m) {
      if (mode === m) m = 'none';
      mode = m;
      canvas.classList.remove('active', 'erasing');
      drawBtn.classList.remove('active');
      eraserBtn.classList.remove('active');
      if (m === 'draw') {
        ensureCanvas();
        canvas.classList.add('active');
        drawBtn.classList.add('active');
        colorStrip.classList.add('visible');
        applyBrush();
      } else if (m === 'erase') {
        ensureCanvas();
        canvas.classList.add('erasing');
        eraserBtn.classList.add('active');
        colorStrip.classList.add('visible');
        applyBrush();
      } else {
        colorStrip.classList.remove('visible');
      }
    }

    drawBtn.addEventListener('click', () => setMode('draw'));
    eraserBtn.addEventListener('click', () => setMode('erase'));

    document.querySelectorAll('.color-dot').forEach(dot => {
      dot.addEventListener('click', () => {
        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
        dot.classList.add('active');
        drawColor = dot.dataset.color;
        if (mode === 'draw') applyBrush();
      });
    });

    function getCanvasPos(e) {
      const rect = canvas.getBoundingClientRect();
      const pt = e.touches ? e.touches[0] : e;
      return {
        x: (pt.clientX - rect.left),
        y: (pt.clientY - rect.top)
      };
    }

    canvas.addEventListener('mousedown', e => {
      if (mode === 'none') return;
      drawing = true;
      applyBrush();
      const p = getCanvasPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    });
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      const p = getCanvasPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
    });
    canvas.addEventListener('mouseup', () => { drawing = false; });
    canvas.addEventListener('mouseleave', () => { drawing = false; });

    canvas.addEventListener('touchstart', e => {
      if (mode === 'none') return;
      e.preventDefault();
      drawing = true;
      applyBrush();
      const p = getCanvasPos(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
    }, { passive: false });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!drawing) return;
      const p = getCanvasPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
    }, { passive: false });
    canvas.addEventListener('touchend', () => { drawing = false; });

    // ── Form submit ──────────────────────────────────
    const form = document.getElementById('contactForm');
    const formSent = document.getElementById('formSent');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      if (anonToggle.checked) { data.set('name', 'Anonymous'); data.delete('_replyto'); }
      try {
        await fetch(form.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
      } catch {}

      // Clear stickers
      layer.innerHTML = '';
      // Clear canvas drawing
      if (canvasReady) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
      canvas.classList.remove('active', 'erasing');
      setMode('none');
      // Hide doodle toolbar and label
      document.getElementById('doodleToolbar').style.display = 'none';
      document.getElementById('letterLabel').style.display = 'none';

      // Hide form, show sent message
      form.style.display = 'none';
      formSent.style.display = 'block';

      // Fold the letter
      letter.classList.add('sent');
    });
  </script>
</body>
</html>
